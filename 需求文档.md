# 记账本项目 - 简化版需求文档

## 项目概述

一个简单的月度盘点记账应用，专注于宏观财务把控，而非细致的流水账。

---

## 一、核心需求

### 1.1 数据记录方式
- **不是流水账**：不需要记录每笔收支明细
- **月度盘点**：每月只盘点一次
- **大方向把握**：专注于存了多少钱、负债少了多少、收益多少、存下多少

### 1.2 数据类目

#### 收入
- 工资收入（税后）
- 兼职收入
- 公积金
- 其他收入（完全自定义录入）

#### 支出
- 还贷款
- 其他支出（完全自定义录入）

#### 资产变动（净储蓄分配）
净储蓄的三个去向：
1. **新增存款** → 累计存款
2. **个人养老金** → 个人养老金账户余额
3. **投资本金** → 累计投资本金
4. **投资收益** → 累计存款

#### 资产数据
- **存款类目**
  - 新增存款
  - 累计存款
  - 个人养老金
    - 新增缴存
    - 累计余额

- **投资类目**
  - 投资本金（新增）
  - 累计本金
  - 投资收益
    - 当月收益
    - 累计收益

#### 贷款数据
- 本月还款
- 贷款余额

---

## 二、页面结构（共4页）

### 主导航菜单
1. 首页（总览）
2. 数据录入（每月盘点）
3. 历史记录
4. 设置（目标 + 数据管理）

---

## 三、页面详细设计

### 1. 首页（总览）

#### 布局
```
┌─────────────────────────────────────────────┐
│  [标题：我的财务总览]  [月份选择] [趋势图选择] │
├─────────────────────────────────────────────┤
│                                             │
│  [当月关键数据卡片]                  │
│  ┌──────┬──────┬──────┬──────┐      │
│  │存入 │ 还贷  │ 收益 │ 净储蓄│      │
│  │XXXX  │ XXXX  │ XXXX  │ XXXX  │      │
│  └──────┴──────┴──────┴──────┘      │
│                                             │
│  [累计关键数据卡片]                  │
│  ┌──────┬──────┬──────┬──────┐      │
│  │存入 │ 还贷  │ 收益 │ 净储蓄│      │
│  │XXXX  │ XXXX  │ XXXX  │ XXXX  │      │
│  └──────┴──────┴──────┴──────┘      │
└─────────────────────────────────────────────┘
│                                             │
│  [关键指标]                             │
│  ┌─────────────────┬───────────────┐   │
│  │储蓄率：XX%   │ 年化收益率：XX%  │   │
│  └─────────────────┴───────────────┘   │
└─────────────────────────────────────────────┘
│                                             │
│  [趋势图区域] - 可切换类型           │
│  - 收入/支出
│  - 存款
│  - 收益
│  - 贷款
└─────────────────────────────────────────────┘
```

#### 数据卡片说明

**当月关键数据**
- 存入 = 新增存款 + 个人养老金 + 投资本金
- 还贷 = 本月还款
- 收益 = 当月投资收益
- 净储蓄 = 总收入 - 总支出

**累计关键数据**
- 存入 = 累计存款 + 个人养老金 + 投资本金累计
- 还贷 = 历史累计还款总额
- 收益 = 投资收益累计
- 净储蓄 = 历史累计净储蓄总额

---

### 2. 数据录入页（每月盘点）

#### 表单结构
```
┌─────────────────────────────────────────────┐
│  📥 收入                             │
├─────────────────────────────────────────────┤
│  工资收入（元）        [          ]      │
│  兼职收入（元）        [          ]      │
│  公积金（元）          [          ]      │
│  其他收入：                               │
│    [奖金：    1000元     [+ 添加]      │
│    [红包：    500元      [× 删除]     │
│                                    [          ]      │
│  总收入：XXXXX元                         │
└─────────────────────────────────────────────┘
│                                             │
│  📤 支出                             │
├─────────────────────────────────────────────┤
│  还贷款（元）        [          ]      │
│  其他支出：                               │
│    [房租：    3000元     [× 删除]     │
│                                    [          ]      │
│  总支出：XXXXX元                         │
└─────────────────────────────────────────────┘
│                                             │
│  净储蓄：XXXXX元（自动计算）          │
├─────────────────────────────────────────────┤
│  💰 净储蓄分配                             │
├─────────────────────────────────────────────┤
│  存款类目                              │
│  新增存款（元）        [          ]      │
│  个人养老金（元）        [          ]      │
│  投资本金（元）        [          ]      │
│                                    [          ]      │
├─────────────────────────────────────────────┤
│  💼 投资收益                             │
│  当月投资收益（元）        [          ]      │
├─────────────────────────────────────────────┤
│  💳 贷款                               │
│  本月还款（元）        [          ]      │
│  贷款余额（元）        XXXX元          │
│                                             │
│                     [ 保存] [取消]                  │
└─────────────────────────────────────────────┘
```

#### 校验规则
- 净储蓄 = 总收入 - 总支出
- 净储蓄分配校验：净储蓄 = 新增存款 + 个人养老金 + 投资本金
- 如果不相等，保存时提示错误

---

### 3. 历史记录页

#### 筛选栏
- 年份选择：下拉选择年份
- 导出 Excel 按钮

#### 列表结构
```
┌─────────────────────────────────────────────┐
│  2025年                                  │
├─────────────────────────────────────────────┤
│  [📅 明细][✏️ 编辑][🗑️ 删除] [📤 导出]    │
│                                              │
│  📥 收入：XXXX元  💰 支出：XXXX元          │
│  📊 净储蓄：XXXXX元  储蓄率：XX%            │
│  💰 收益：XXXX元                             │
│                                              │
└─────────────────────────────────────────────┘
```

#### 详情查看
点击"明细"查看完整数据：
- 收入明细（工资、兼职、公积金、其他收入）
- 支出明细（还贷款、其他支出）
- 资产变动（存款、养老金、投资）
- 关键指标（储蓄率、年化收益率）

#### 导出功能
- 导出范围：单月 / 全部 / 指定年份
- 格式：Excel (.xlsx)

---

### 4. 设置页

#### 4.1 目标设置

##### 月度目标
```
┌─────────────────────────────────────────────┐
│  🎯 月度目标               [+ 新增月度目标]      │
├─────────────────────────────────────────────┤
│  ┌─────────────────┬─────────────┬──────┐│
│  │月度存款目标  │ 目标：XXXXX  │完成度：XX%│  │
│  │                [███████████████░]      │ [删除]     │
│  ├─────────────────┼─────────────┼──────┤│
│  │月度还款目标  │ 目标：XXXXX  │完成度：XX%│  │
│  │                [██████████████░]      │ [删除]     │
│  └─────────────────┴─────────────┴──────┘│
│                                        [删除]     │
│  [+ 新增年度目标]                      │
└─────────────────────────────────────────────┘
```

##### 年度目标
```
┌─────────────────────────────────────────────┐
│  📅 年度目标               [+ 新增年度目标]      │
├─────────────────────────────────────────────┤
│  年度存款目标：XXXXX元                          │
│  完成度：XX / XX%  [██████████████░]          │
│                                        [删除]     │
└─────────────────────────────────────────────┘
```

#### 4.2 数据管理

```
┌─────────────────────────────────────────────┐
│  📤 数据管理                             │
├─────────────────────────────────────────────┤
│                                             │
│  导出全部数据到 Excel     [导出 Excel]       │
│                                             │
│  从文件导入备份数据     [导入数据]       │
│                                             │
│                                             │
│  清空所有应用数据（警告） [清空数据]       │
│                                             │
└─────────────────────────────────────────────┘
```

#### 导出数据包含
- 月度数据（所有字段）
- 目标数据
- 初始资产

---

### 5. 初始设置页（首次使用）

#### 表单结构
```
┌─────────────────────────────────────────────┐
│  🏦 初始资产设置                             │
├─────────────────────────────────────────────┤
│  存款（元）              [          ]      │
│  贷款（元）              [          ]      │
│  个人养老金（元）          [          ]      │
│  投资本金（元）          [          ]      │
│  投资收益（元）          [          ]      │
│                                             │
│                     [ 完成设置]                  │
└─────────────────────────────────────────────┘
```

---

## 四、技术设计

### 技术栈
- **前端框架**：React 18 + TypeScript
- **构建工具**：Vite
- **UI 组件库**：Ant Design 5.x
- **图表库**：ECharts
- **路由**：React Router DOM 7
- **导出 Excel**：xlsx 库
- **日期处理**：dayjs
- **数据存储**：LocalStorage

### 项目结构
```
src/
├── components/          # 可复用组件
│   └── TrendChart.tsx     # 趋势图组件
├── pages/              # 页面组件
│   ├── Home.tsx         # 首页
│   ├── DataEntry.tsx     # 数据录入页
│   ├── History.tsx        # 历史记录页
│   ├── Settings.tsx  # 设置页
│   └── InitialSetup.tsx  # 初始资产设置页
├── contexts/            # Context
│   └── DataContext.tsx    # 数据管理 Context
├── types/              # 类型定义
│   └── index.ts
├── utils/              # 工具函数
│   ├── storage.ts        # LocalStorage 工具
│   └── format.ts        # 格式化函数
├── App.tsx             # 应用入口
├── main.tsx            # React 挂载
├── index.css            # 全局样式
└── index.html           # HTML 模板
```

---

## 五、核心功能特性

### 1. 数据持久化
- 使用 LocalStorage 存储所有数据
- 数据包括：月度数据、目标、初始资产
- 初始化状态标记

### 2. 响应式设计
- 使用 Ant Design 的响应式组件
- 适配桌面端和移动端
- Grid 布局自动调整

### 3. 校验机制
- 净储蓄分配校验
- 必填字段验证
- 数据类型检查

### 4. 交互体验
- Ant Design 中文本地化
- 友好的错误提示
- 加载状态显示

### 5. 数据可视化
- ECharts 折线图/柱状图（趋势图）
- 支持图表交互（tooltip、图例切换）

### 6. Excel 导出
- 支持单月/全部/指定年份导出
- xlsx 库生成 Excel 文件

---

## 六、数据流程设计

### 净储蓄分配流程
```
总收入（工资 + 兼职 + 公积金 + 其他收入）
    ↓
总支出（还贷款 + 其他支出）
    ↓
净储蓄 = 总收入 - 总支出
    ↓
净储蓄分配到：
  - 新增存款
  - 个人养老金
  - 投资本金
  （需校验：总和 = 净储蓄）
```

### 累计计算
```
存款类目：
  - 累计存款 = 历史累计新增存款 + 初始资产
  - 个人养老金 = 历史累计新增缴存 + 初始资产

投资类目：
  - 累计本金 = 历史累计新增本金 + 初始资产
  - 累计收益 = 历史累计收益 + 初始资产
```

---

## 七、使用流程

### 首次使用
1. 打开应用，自动跳转到初始资产设置页
2. 填写初始资产：
   - 存款
   - 贷款
   - 个人养老金
   - 投资本金
   - 投资收益
3. 点击"完成设置"
4. 自动跳转到首页

### 月度盘点
1. 选择月份
2. 录入各项数据：
   - 收入（工资、兼职、公积金、其他收入）
   - 支出（还贷款、其他支出）
   - 净储蓄分配（存款、养老金、投资本金）
   - 投资收益
   - 本月还款
3. 系统自动计算：
   - 总收入
   - 总支出
   - 净储蓄
   - 累计数据（自动计算）
4. 保存（校验净储蓄分配）

### 查看总览
1. 查看当月/累计关键数据卡片
2. 查看关键指标（储蓄率、年化收益率）
3. 查看趋势图（可切换类型）

### 目标管理
1. 添加月度/年度目标
2. 设置目标金额
3. 查看完成进度
4. 删除目标

### 历史记录
1. 按年份筛选查看
2. 查看每月明细
3. 编辑/删除记录
4. 导出 Excel

### 数据管理
1. 导出所有数据（备份）
2. 导入备份数据
3. 清空所有数据

---

## 八、关键指标计算

### 储蓄率
```
储蓄率 = 净储蓄 / 总收入 × 100%
```

### 年化收益率（简化计算）
```
年化收益率 = (累计收益 / 累计投资本金) × 100%

注：这是简化版本，如果需要更精确的XIRR计算可以后续添加
```

---

## 九、数据类型定义

### MonthlyData（月度数据）
```typescript
interface MonthlyData {
  id: string;
  year: number;
  month: number;

  // 收入
  salary: number;           // 工资收入（税后）
  sideJob: number;           // 兼职收入
  providentFund: number;      // 公积金
  otherIncomes: IncomeItem[];
  totalIncome: number;

  // 支出
  loanRepayment: number;    // 还贷款
  otherExpenses: ExpenseItem[];
  totalExpense: number;

  // 净储蓄（自动计算）
  netSavings: number;

  // 资产变动
  newDeposit: number;         // 新增存款
  totalDeposit: number;         // 累计存款

  pensionContribution: number; // 个人养老金新增
  pensionBalance: number;      // 个人养老金累计

  investmentPrincipal: number;      // 投资本金新增
  totalInvestmentPrincipal: number; // 投资本金累计

  investmentReturn: number;       // 投资收益当月
  totalInvestmentReturn: number;    // 投资收益累计

  // 贷款
  monthlyLoanPayment: number; // 本月还款
  loanBalance: number;          // 贷款余额

  // 时间戳
  createdAt: number;
  updatedAt: number;
}
```

### IncomeItem（收入明细）
```typescript
interface IncomeItem {
  id: string;
  name: string;
  amount: number;
}
```

### ExpenseItem（支出明细）
```typescript
interface ExpenseItem {
  id: string;
  name: string;
  amount: number;
}
```

### InitialAssets（初始资产）
```typescript
interface InitialAssets {
  deposit: number;
  loan: number;
  pension: number;
  investmentPrincipal: number;
  investmentReturn: number;
}
```

### Goal（目标）
```typescript
interface Goal {
  id: string;
  type: GoalType;
  name: string;
  targetAmount: number;
  currentAmount: number;
  createdAt: number;
  updatedAt: number;
}

type GoalType = 'monthlyDeposit' | 'monthlyRepayment' | 'yearlyDeposit' | 'other';
```

---

## 十、开发说明

### 本地运行
1. 安装依赖：`npm install`
2. 启动开发服务器：`npm run dev`
3. 访问：`http://localhost:5173`

### 构建
- `npm run build` - 生产版本
- `npm run preview` - 预览生产版本

### 技术配置
- TypeScript 严格模式关闭（减少类型错误）
- Vite 模块化配置
- Ant Design 组件库中文本地化

---

## 十一、总结

这是一个专注于**月度盘点**和**宏观财务把控**的记账应用，特点：

1. ✅ 不记录日常流水账，只在月底盘点一次
2. ✅ 通过趋势图了解财务趋势
3. ✅ 通过数据卡片快速查看关键指标
4. ✅ 设置目标并追踪进度
5. ✅ 简单易用的 Excel 导出/导入功能
6. ✅ 云端部署（GitHub + Vercel），数据安全存储在浏览器
7. ✅ 响应式设计，适配桌面和移动端
8. ✅ 简化的4页结构，功能精简但完整
